</html>
<body>
<h2>Gooooooomusic</h2>

<input id="q" type="text" onsubmit="search()"/>
<button type="button" onclick="search()">Search</button>

<pre id="content"></pre>
</body>
<script type="text/javascript">

function init()
{
            if ("WebSocket" in window)
               {
               // Let us open a web socket
               var ws = new WebSocket("ws://localhost:15000/");

               ws.onopen = function()
               {
                    log("Socket open");
               };

               ws.onmessage = function (evt)
               {
                    var received_msg = evt.data;
		               var reader = new FileReader();
                           //console.log(received_msg);
                           reader.addEventListener("loadend", function() {
                                // reader.result contains the contents of blob as a typed array
                               //console.log("Received (decoded blob)"+reader.result);
                                var result= reader.result;
                                if(result == "------------completed--------")
                                    log("<strong>Search Completed</strong>");
                                else
                                {
                                    var obj = JSON.parse(reader.result);
                                    log("<strong>"+obj.artist+"</strong>-"+obj.title);
                                }

                            });
                           text=reader.readAsText(received_msg);
               };

               ws.onclose = function()
               {

		        log("Connection closed");
               };
            }
            else
            {
               // The browser doesn't support WebSocket
               alert("WebSocket NOT supported by your Browser!");
            }

            window.ws=ws;
}

function search()
{

		  // Web Socket is connected, send data using send()

          //get data from
          var queryTerm = document.getElementById("q").value;
          document.getElementById("content").innerHTML="";

          window.ws.send(queryTerm);

          log("Searching for "+queryTerm);


}

function log(text)
{
    document.getElementById("content").innerHTML +=text+ "<br/>";
}



init();


</script>

</html>

