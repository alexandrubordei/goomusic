</html>
<body>
<h2>Gooooooomusic</h2>

<input id="q" type="text"/>
<button type="button" onclick="search()">Search</button>

<pre id="content"></pre>
</body>
<script type="text/javascript">

function init()
{
            if ("WebSocket" in window)
               {
               // Let us open a web socket
               var ws = new WebSocket("ws://instance-11039.bigstep.io:15000/");

               ws.onopen = function()
               {
                    log("Socket open");
               };

               ws.onmessage = function (evt)
               {
                        var received_msg = evt.data;
                        var reader = new FileReader();
                        reader.addEventListener("loadend", function() {
                               //reader.result contains the contents of blob as a typed array
                                var result= reader.result;
                                if(result == "------------completed--------")
                                {
                                    var duration=new Date() - window.searchstarted;
                                    delete window.searchstarted    
                                    log("<strong>Search Complete in "+duration+" milliseconds</strong>");
                                    
                                }
                                else
                                {
                                    var obj = JSON.parse(reader.result);
                                    log("<strong>"+obj.artist+"</strong>-"+obj.title);
                                }

                            });
                           text=reader.readAsText(received_msg);
               };

               ws.onclose = function()
               {
                        log("Connection closed");
               };
            }
            else
            {
               // The browser doesn't support WebSocket
               alert("WebSocket NOT supported by your Browser!");
            }

            window.ws=ws;

           document.getElementById("q").onkeypress = function(evt) {
                if(evt.keyCode === 13)
                        search();
           }

}

function search()
{
          if(window.searchstarted)
          {
                alert("Search in progress")
                return;
          }

          var queryTerm = document.getElementById("q").value;
          document.getElementById("content").innerHTML="";

          window.ws.send(queryTerm);

          log("Searching for "+queryTerm);
          window.searchstarted=new Date(); 
}

function log(text)
{
    document.getElementById("content").innerHTML +=text+ "<br/>";
}



init();


</script>
</html>

